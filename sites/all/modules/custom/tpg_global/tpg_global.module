<?php

/**
 * @file
 * Code for the TPG Global.
 */

/**
 * Implements hook_views_pre_render().
 */
function tpg_global_views_pre_render(&$view) {
  // Related Activities view.
  if ($view->name == 'related_activities') {
    $view->result = _tpg_global_related_terms($view->result);
  }
}

/**
 * Identifies content with same taxonomy term for SubType field.
 * @param object
 *    View results oject.
 * @return object
 *    Modified view results object.
 */
function _tpg_global_related_terms($results) {
  // Fetching node object from menu.
  $node = menu_get_object('node');

  foreach ($node->field_paragraphs_content['und'] as $key => $paragraph_item) {
    // Loading paragraphs bundle from automated id.
    $data = paragraphs_item_load($paragraph_item['value']);
    // Checking Title section bundle that contains SubType Term reference field.
    if ($data->bundle == 'title_section') {
      foreach ($results as $key => $result) {
        // Term id from other contents.
        $term_id = $result->field_field_paragraphs_subtype[0]['raw']['tid'];

        // Checks term id one from the menu object id if not same removes the
        // content from the view results.
        if ($term_id != $data->field_paragraphs_subtype['und'][0]['tid']) {
          unset($results[$key]);
        }
      }
      return $results;
    }
  }
  return array();
}

/**
 * Implements hook_views_query_alter().
 */
function tpg_global_views_query_alter(&$view, &$query) {
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function tpg_global_form_paragraphs_page_node_form_alter(&$form, &$form_state, $form_id) {
  // Adding range of weights.
  $range = array();
  for ($i = -20; $i <= 20; ++$i) {
    $range[$i] = $i;
  }
  $form['field_homepage_weight']['und']['#options'] = $range;
  $form['field_homepage_weight']['und']['#default_value'] = 0;
}

